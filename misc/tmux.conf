# Modeline and Notes {
# vim: set foldmarker={,} foldlevel=1 foldmethod=marker:
# }
# https://wiki.archlinux.org/index.php/Tmux
#
" basic setup {

unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

## start numbering at 1 for easier switch
set -g base-index 1
set-window-option -g pane-base-index 1


set -g default-command /bin/zsh

##tell me when stuff happens in other windows
setw -g monitor-activity on
set -g visual-activity on

## utf8 is on
#set -g utf8 on
#set -g status-utf8 on
#
## address vim mode switching delay (http://superuser.com/a/252717/65504)
#set -s escape-time 0
#
## increase scrollback buffer size
set -g history-limit 50000
#
## tmux messages are displayed for 4 seconds
set -g display-time 4000

# prevent lots of text from freezing screen
# #
# in 2.1 * The c0-* options for rate-limiting have been removed.  Instead, a backoff approach is used.
#setw -g c0-change-trigger 10
#setw -g c0-change-interval 250


# Turn on window titles
set -g set-titles on

# Set window title string
#  #H  Hostname of local host
#  #I  Current window index
#  #P  Current pane index
#  #S  Session name
#  #T  Current window title
#  #W  Current window name
#  #   A literal ‘#’
set -g set-titles-string '#S:#I.#P #W'

# Automatically set window title
setw -g automatic-rename
" end basic setup }

" keybindings {

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

##v(ertical) is vi-like, but s(plit) and h(orizontal) are already taked so using m(iddle)...
#
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

bind-key v split-window -p 20 -c "#{pane_current_path}"
bind-key V split-window -p 20 -c "#{pane_current_path}" '\;' swap-pane -U

bind-key - split-window -v  -c "#{pane_current_path}"
bind-key _ split-window -v  -c "#{pane_current_path}" '\;' swap-pane -U

bind-key m split-window -h -c "#{pane_current_path}"
bind-key M split-window -h   -c "#{pane_current_path}" '\;' swap-pane -U
bind-key | split-window -h  -c "#{pane_current_path}"

## force a reload of the config file
unbind r
bind r source-file ~/.tmux.conf\; refresh-client -S
## quick pane cycling
unbind ^A
bind ^A select-pane -t :.+
##overwrote p(revious) so doing this
bind-key N previous-window
#
#
bind-key -r "<" swap-window -d -t -1
bind-key -r ">" swap-window -d -t +1

bind-key [ swap-pane -d -U
bind-key ] swap-pane -d -D

bind-key M choose-tree -w "join-pane -t '%%'"
bind-key C-m choose-tree -s "join-pane -t '%%'"


" end keybindings }

" statusline {

set -g status-left-length 52
set -g status-right-length 451
set -g status-fg white
set -g status-bg colour234
set -g window-status-activity-attr bold
set -g pane-border-fg colour245
set -g pane-active-border-fg colour39
set -g message-fg colour16
set -g message-bg colour221
set -g message-attr bold
set -g status-interval 5
#
set -g status-right "#[fg=red]%m/%d|%T"
# https://github.com/tmux/tmux/wiki/FAQ#how-do-i-translate--fg--bg-and--attr-options-into--style-options
#set-window-option -g window-status-current-bg red
setw -g window-status-current-style fg=white,bg=red,bright
#
#set -g status-fg white
## Highlight active window
" end statusline }
" plugins {

# tmux plugins:
# https://github.com/tmux-plugins/tpm
## List of plugins
## Supports `github_username/repo` or full git URLs
#set -g @tpm_plugins "              \
  #tmux-plugins/tpm                 \
  #tmux-plugins/tmux-yank       \
  #tmux-plugins/tmux-open    \
  #tmux-plugins/tmux-logging    \
  #tmux-plugins/tmux-sidebar \
  #thalesmello/tmux-copycat \
#"
  # 2019-01-05 see issue resolved on Nov 21, 2017
  # replaced with thalesmello fork due to 2.4 breaking changes https://github.com/tmux-plugins/tmux-copycat/issues/109
  #tmux-plugins/tmux-copycat    \ " disabled


## Other examples:
## github_username/plugin_name    \
## git@github.com/user/plugin     \
## git@bitbucket.com/user/plugin  \
#
## initializes TMUX plugin manager
# TODO disabled was err 127 bc https://github.com/tmux-plugins/tpm/issues/67
##run-shell ~/.tmux/plugins/tpm/tpm
#set-environment -g PATH "/usr/local/bin:/bin:/usr/bin"
#run-shell ~/.tmux/plugins/tpm/tpm

set -g @plugin 'tmux-plugins/tpm'
#set -g @plugin  'tmux-plugins/tmux-yank' " 2019-01-05 believe was fucking up my copy paste config by overwriting it
#set -g @plugin  'tmux-plugins/tmux-open'
#set -g @plugin  'tmux-plugins/tmux-copycat'
" logging and sessionist where only enabled
#set -g @plugin  'tmux-plugins/tmux-logging'
#set -g @plugin  'tmux-plugins/tmux-sessionist'
run -b ~/.tmux/plugins/tpm/tpm

set -g @default_logging_path '/home/kstock/struct/'
#set -g @yank_selection 'primary' # or 'secondary' or 'clipboard'
" end plugins }

" mouse {

#  mouse mode changed in 2.1
set-option -g -q mouse on
#set -g mode-mouse on
#setw -g mouse-select-window on
#setw -g mouse-select-pane on

" end mouse }

" copy paste {

##make copy vim-like
# changed in 2.5!
unbind [
bind Escape copy-mode
unbind p
#bind p paste-buffer
bind-key p run "xsel -o -b | tmux load-buffer - ; tmux paste-buffer"

setw -g mode-keys vi
bind-key -Tcopy-mode-vi 'v' send -X begin-selection
# https://unix.stackexchange.com/questions/348913/copy-selection-to-a-clipboard-in-tmux
#bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'
# TODO macos needed?
# https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -i -selection clipboard "
" end copy paste }


